CREATE TABLE EDITORIAL(
    NOMBRE CHAR(10),
    DIRECCION VARCHAR2(20),
    TELEFONO NUMBER(10),
    CONSTRAINT ED_PK PRIMARY KEY(NOMBRE)
);

CREATE TABLE PUBLICACION(
    ISBN NUMBER(10),
    AUTORES VARCHAR2(20),
    TITULO VARCHAR2(20),
    IDIOMA VARCHAR2(10),
    NEDITORIAL CHAR(10),
    CONSTRAINT PU_PK PRIMARY KEY(ISBN),
    CONSTRAINT PU_FK FOREIGN KEY(NEDITORIAL) REFERENCES EDITORIAL
);

CREATE TABLE REVISTA(
    ISBN NUMBER(10),
    PERIODO DATE,
    CONSTRAINT RE_PK PRIMARY KEY(ISBN),
    CONSTRAINT RE_FK FOREIGN KEY(ISBN) REFERENCES PUBLICACION
);

CREATE TABLE LIBRO(
    ISBN NUMBER(10),
    EDICION NUMBER(2),
    ANIO DATE,
    CONSTRAINT LI_PK PRIMARY KEY(ISBN),
    CONSTRAINT LI_FK FOREIGN KEY(ISBN) REFERENCES PUBLICACION
);

CREATE TABLE BIBLIOTECA(
    DISTRITO CHAR(10),
    DIRECCION VARCHAR(20),
    CONSTRAINT BI_PK PRIMARY KEY(DISTRITO)
);

CREATE TABLE SOCIO(
    NCARNET NUMBER(10),
    NOMBRE  CHAR(10),
    DNI     VARCHAR2(9),
    EMAIL   VARCHAR2(15),
    DISTRITO CHAR(10),
    CONSTRAINT SO_PK PRIMARY KEY(NCARNET),
    CONSTRAINT SO_FK FOREIGN KEY(DISTRITO) REFERENCES BIBLIOTECA
);

CREATE TABLE EJEMPLAR_REVISTA(
    ISBN NUMBER(10),
    DISTRITO CHAR(10),
    NUMERO NUMBER(5),
    FECHACOMPRA DATE,
    CONSTRAINT ER_PK PRIMARY KEY(NUMERO),
    CONSTRAINT ER_FK1 FOREIGN KEY(ISBN) REFERENCES REVISTA,
    CONSTRAINT ER_FK2 FOREIGN KEY(DISTRITO) REFERENCES BIBLIOTECA
);

CREATE TABLE EJEMPLAR_LIBRO(
    ISBN NUMBER(10),
    DISTRITO CHAR(10),
    NUMERO NUMBER(5),
    FECHACOMPRA DATE,
    CONSTRAINT EL_PK PRIMARY KEY(NUMERO),
    CONSTRAINT EL_FK1 FOREIGN KEY(ISBN) REFERENCES LIBRO,
    CONSTRAINT EL_FK2 FOREIGN KEY(DISTRITO) REFERENCES BIBLIOTECA
);

CREATE TABLE PRESTAMO(
    NSOCIO NUMBER(10),
    FECHAPRESTAMO DATE,
    ISBN NUMBER(10),
    DISTRITO CHAR(10),
    NUMERO NUMBER(5),
    NUMDIAS NUMBER(5),
    CONSTRAINT PR_PK PRIMARY KEY(FECHAPRESTAMO),
    CONSTRAINT PR_FK1 FOREIGN KEY(NSOCIO) REFERENCES SOCIO,
    CONSTRAINT PR_FK2 FOREIGN KEY(ISBN) REFERENCES EJEMPLAR_LIBRO,
    CONSTRAINT NU_CK CHECK(NUMDIAS>0)
);

//EJERCICIO 3
ALTER SESSION SET NLS_DATE_FORMAT='DD-MM-YYYY';
//EJERCICIO 3.1.-
INSERT INTO BIBLIOTECA VALUES('MADRID','CALLE 1');
INSERT INTO BIBLIOTECA VALUES('MORATALAZ','CALLE 1');

//EJERCICIO 3.2.-
//COMO TIENE CLAVE FORANEA A LIBRO(->PUBLICACION->(EDITORIAL)) Y BIBLIOTECA
//PRIMERO SE CREAN REGISTROS AHI
CREATE SEQUENCE SQ_EJEMPLARES_LIBROS START WITH 1 INCREMENT BY 1;
SELECT SQ_EJEMPLARES_LIBROS.NEXTVAL FROM DUAL;

//LIBRO, BIBLIOTECA SE AÑADIO EN EJERCICIO 1
//LIBRO1
INSERT INTO EDITORIAL VALUES('EDITORIAL1','DIRECCION1','99999999');
INSERT INTO PUBLICACION VALUES('97884481','AUTOR1','TITULO1',
'ESPAÑOL','EDITORIAL1');
INSERT INTO LIBRO VALUES('97884481','5',TO_DATE('01-01-2018'));
INSERT INTO EJEMPLAR_LIBRO VALUES('97884481','MADRID',SQ_EJEMPLARES_LIBROS.CURRVAL
,TO_DATE(SYSDATE));
INSERT INTO EJEMPLAR_LIBRO VALUES('97884481','MADRID',SQ_EJEMPLARES_LIBROS.NEXTVAL
,TO_DATE(SYSDATE));
//LIBRO2
INSERT INTO EDITORIAL VALUES('EDITORIAL2','DIRECCION2','99999999');
INSERT INTO PUBLICACION VALUES('97884482','AUTOR2','TITULO2',
'ESPAÑOL','EDITORIAL2');
INSERT INTO LIBRO VALUES('97884482','5',TO_DATE('01-01-2018'));
INSERT INTO EJEMPLAR_LIBRO VALUES('97884482','MADRID',SQ_EJEMPLARES_LIBROS.NEXTVAL
,TO_DATE(SYSDATE));

//EJERCICIO 3.3 
DROP SEQUENCE SQ_EJEMPLARES_LIBROS;
CREATE SEQUENCE SQ_EJEMPLARES_LIBROS START WITH 1 INCREMENT BY 1;
SELECT SQ_EJEMPLARES_LIBROS.NEXTVAL FROM DUAL;
INSERT INTO EJEMPLAR_LIBRO VALUES('97884481','MORATALAZ',SQ_EJEMPLARES_LIBROS.NEXTVAL
,TO_DATE(SYSDATE));
INSERT INTO EJEMPLAR_LIBRO VALUES('97884482','MORATALAZ',SQ_EJEMPLARES_LIBROS.NEXTVAL
,TO_DATE(SYSDATE));
INSERT INTO EJEMPLAR_LIBRO VALUES('97884482','MORATALAZ',SQ_EJEMPLARES_LIBROS.NEXTVAL
,TO_DATE(SYSDATE));

//EJERCICIO 3.5

INSERT INTO SOCIO VALUES('1','NOMBRE1','123321','EMAIL1','MADRID');
INSERT INTO SOCIO VALUES('2','NOMBRE2','123322','EMAIL2','MADRID');
